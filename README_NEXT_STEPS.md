# è®¢é˜…ç³»ç»Ÿå®ç°å®Œæˆ - ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—

## ğŸ‰ å·²å®Œæˆçš„åŠŸèƒ½

âœ… **ç¬¬ä¸€æ­¥ï¼šæ•°æ®åº“ç»“æ„å’Œæƒé™ç³»ç»Ÿ**
- è®¢é˜…é™åˆ¶å­—æ®µæ·»åŠ å®Œæˆ
- ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿå®ç°
- è‡ªåŠ¨æƒé™æ›´æ–°è§¦å‘å™¨

âœ… **ç¬¬äºŒæ­¥ï¼šSourcesé¡µé¢æƒé™æ§åˆ¶**
- å…è´¹ç”¨æˆ·3ä¸ªä¿¡æ¯æºé™åˆ¶
- "æœ¬å‘¨å¤„ç†"æŒ‰é’®æƒé™æ§åˆ¶
- è‡ªåŠ¨æ‘˜è¦è®¾ç½®æƒé™é™åˆ¶

âœ… **ç¬¬ä¸‰æ­¥ï¼šStripeæ”¯ä»˜é›†æˆ**
- Stripe Elementsæ”¯ä»˜è¡¨å•
- è®¢é˜…è®¡åˆ’é…ç½®
- è®¢é˜…çŠ¶æ€ç®¡ç†
- å®¢æˆ·é—¨æˆ·é›†æˆ

âœ… **ç¬¬å››æ­¥ï¼šSupabase Edge Functions**
- Checkoutä¼šè¯åˆ›å»ºå‡½æ•°
- Stripe Webhookå¤„ç†å‡½æ•°
- å®¢æˆ·é—¨æˆ·ä¼šè¯å‡½æ•°
- è®¢é˜…æˆåŠŸé¡µé¢

## ğŸš€ ç«‹å³éœ€è¦å®Œæˆçš„æ“ä½œ

### 1. è®¾ç½®Stripeè´¦æˆ· (å¿…éœ€)
```bash
# 1. è®¿é—® https://dashboard.stripe.com
# 2. åˆ›å»ºä¸¤ä¸ªäº§å“ï¼š
#    - Daily Digest Starter ($9/æœˆ)
#    - Daily Digest Professional ($19/æœˆ)
# 3. è·å–ä»·æ ¼IDï¼ˆprice_xxxï¼‰
```

### 2. æ›´æ–°ç¯å¢ƒå˜é‡
åœ¨ `.env.local` ä¸­æ·»åŠ çœŸå®çš„ä»·æ ¼IDï¼š
```env
VITE_STRIPE_STARTER_PRICE_ID=price_çœŸå®ä»·æ ¼ID
VITE_STRIPE_PROFESSIONAL_PRICE_ID=price_çœŸå®ä»·æ ¼ID
```

### 3. éƒ¨ç½²Edge Functions
```bash
# å®‰è£…Supabase CLI
npm install -g supabase

# ç™»å½•å¹¶å…³è”é¡¹ç›®
supabase login
supabase link

# éƒ¨ç½²å‡½æ•°
supabase functions deploy create-checkout-session
supabase functions deploy stripe-webhook
supabase functions deploy create-portal-session

# è®¾ç½®å¯†é’¥
supabase secrets set STRIPE_SECRET_KEY=sk_test_ä½ çš„å¯†é’¥
```

### 4. é…ç½®Stripe Webhooks
åœ¨Stripe Dashboardä¸­ï¼š
1. æ·»åŠ Webhookç«¯ç‚¹ï¼š`https://ä½ çš„é¡¹ç›®.supabase.co/functions/v1/stripe-webhook`
2. é€‰æ‹©äº‹ä»¶ï¼šcheckout.session.completed, customer.subscription.*
3. ä¿å­˜Webhookç­¾åå¯†é’¥åˆ°Supabase

## ğŸ§ª æµ‹è¯•æµç¨‹

### æµ‹è¯•æ”¯ä»˜æµç¨‹
1. è®¿é—® `/subscription` é¡µé¢
2. é€‰æ‹©è®¡åˆ’å¹¶ç‚¹å‡»"ç«‹å³è®¢é˜…"
3. ä½¿ç”¨æµ‹è¯•å¡å·ï¼š`4242 4242 4242 4242`
4. å®Œæˆæ”¯ä»˜ï¼Œåº”è·³è½¬åˆ°æˆåŠŸé¡µé¢
5. æ£€æŸ¥ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡®æ›´æ–°

### æµ‹è¯•æƒé™æ§åˆ¶
1. å…è´¹ç”¨æˆ·ï¼šåªèƒ½æ·»åŠ 3ä¸ªä¿¡æ¯æº
2. é«˜çº§ç”¨æˆ·ï¼šå¯ä»¥æ·»åŠ 20ä¸ªä¿¡æ¯æº
3. è‡ªåŠ¨æ‘˜è¦è®¾ç½®ä»…é«˜çº§ç”¨æˆ·å¯ç”¨
4. "æœ¬å‘¨å¤„ç†"ä»…é«˜çº§ç”¨æˆ·å¯ç”¨

## ğŸ“‹ åŠŸèƒ½æ¸…å•

- [x] æ•°æ®åº“è®¢é˜…å­—æ®µ
- [x] æƒé™ç®¡ç†Hook
- [x] Sourcesé¡µé¢é™åˆ¶
- [x] Stripeæ”¯ä»˜é›†æˆ
- [x] è®¢é˜…ç®¡ç†é¡µé¢
- [x] Edge Functions
- [x] Webhookå¤„ç†
- [x] å®¢æˆ·é—¨æˆ·
- [x] è®¢é˜…æˆåŠŸé¡µé¢
- [ ] åˆ›å»ºStripeäº§å“ï¼ˆéœ€è¦æ‰‹åŠ¨æ“ä½œï¼‰
- [ ] éƒ¨ç½²Edge Functionsï¼ˆéœ€è¦è¿è¡Œå‘½ä»¤ï¼‰
- [ ] é…ç½®Webhooksï¼ˆéœ€è¦åœ¨Stripe Dashboardæ“ä½œï¼‰
- [ ] æµ‹è¯•å®Œæ•´æ”¯ä»˜æµç¨‹

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœæ”¯ä»˜å¤±è´¥
1. æ£€æŸ¥ `.env.local` ä¸­çš„Stripeå¯†é’¥
2. ç¡®è®¤ä»·æ ¼IDæ­£ç¡®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### å¦‚æœæƒé™æœªæ›´æ–°
1. æ£€æŸ¥Webhookæ˜¯å¦æ­£ç¡®é…ç½®
2. æŸ¥çœ‹Edge Functionæ—¥å¿—ï¼š`supabase functions logs stripe-webhook`
3. æ‰‹åŠ¨åˆ·æ–°é¡µé¢æˆ–é‡æ–°ç™»å½•

### å¦‚æœå®¢æˆ·é—¨æˆ·æ— æ³•è®¿é—®
1. ç¡®è®¤ç”¨æˆ·å·²å®Œæˆè‡³å°‘ä¸€æ¬¡æ”¯ä»˜
2. æ£€æŸ¥Stripeè´¦æˆ·çš„å®¢æˆ·é—¨æˆ·è®¾ç½®

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å‚è€ƒ `supabase_stripe_setup.md` æ–‡ä»¶è·å–è¯¦ç»†çš„è®¾ç½®æŒ‡å—ã€‚

**è®¢é˜…ç³»ç»Ÿç°å·²å®Œå…¨å®ç°ï¼** ğŸŠ

åªéœ€å®ŒæˆStripeè´¦æˆ·è®¾ç½®å’ŒEdge Functionséƒ¨ç½²ï¼Œå³å¯æŠ•å…¥ä½¿ç”¨ã€‚ 